{% extends 'base.html.twig' %}

{% block title %}{{ tricks.name }}{% endblock %}





{% block body %}
    <div class="container">
        <h1> Nom du Trick : {{ tricks.name }} </h1>

        <!-- Image a la une -->
        <div class="row">
            <div class="col-lg-12 text-center" >
                <div class="first-picture">
                    {% if tricks.media[0].path is defined %}
                        <img class="card-img-top" src="/uploads/{{ tricks.media[0].path}}" alt="{{tricks.media[0].text }}" >
                    {% endif %}
                </div>
            </div>
        </div>

        <p> Contenu : {{ tricks.content }} </p>

        <p> Les autres image du tricks :
        </p>
        {% for media in medias %}
            {%  if media.text != "Embed" %}
                <img class="img-fluid " src="/uploads/{{ media.path }}" alt="" width="33%;">
            {% endif  %}
        {% endfor %}



        <p> Voir des vidéo : </p>
        {% for media in medias %}
            {%  if media.text == "Embed" %}
            {{ media.path|html }}
            {% endif  %}

        {% endfor %}

        <!-- Comment -->
            <hr/>
        <h3> Vous avez {{ tricks.comments|length }} Commentaires</h3>
        <div id="commentList">
            {%   for comment in comment   %}
                <hr>
                <div class="col-sm3">
                    <img class="rounded-circle" src="/uploads/users/{{ comment.user.picture }}" alt="" width="3%;">
                    {{ comment.user.FirstName }}  dit :<br/>

                    {{ comment.content }}
                    <br/>
                    <br/>
                    le {{ comment.publishedAt ? comment.publishedAt|date('Y-m-d') : 'unpublished' }}
                </div>

                <hr>
            {% endfor %}
            <br/>
        </div>

        <div class="row">
            <div class="col-12 text-center">
                <button id="loadMoreComment" class="btn btn-primary">Voir plus de Commentaires</button>
            </div>
        </div>
         <!-- end pagination -->
            {% if is_granted('ROLE_USER') %}
                <h3> <i class="pr-3 fa fa-comment"></i> Laissez nous un commentaire ! </h3>
                {{ form_start(commentForm) }}
                    {{ form_widget(commentForm) }}
                        <button class="btn btn-lg btn-primary btn-block" type="submit">publié</button>
                    {{ form_end(commentForm) }}

            {% else %}
                <h2> Veuillez vous Connecter pour participer a l'échange ! </h2>
            {% endif %}
    </div>

{% endblock %}



{% block javascripts %}
    {{ parent() }}
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous">
    </script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        click = 0;
        function loadMoreComments(event) {
            event.preventDefault();
            click++;
            var start = 3 * click;
            const url = "{{ path('loadMoreComment', {'tricks': tricks.id} )}}/" + start;
            axios.get(url).then(function(response) {
                $("#commentList").append(response.data);
            }).catch(function (error) {
                if (response.status === 403) {
                    window.alert("Vous n'êtes pas autorisé à effectuer cette action !");
                }
                else if (response.status === 404) {
                    window.alert("La page appelé n'existe pas");
                }
                else {
                    window.alert("Une erreur est survenue !");
                }
            });
        }
        document.getElementById("loadMoreComment").addEventListener("click", loadMoreComments);
    </script>

{% endblock %}

